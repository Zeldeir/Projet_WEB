<!DOCTYPE html>
<script src="socket.io/socket.io.js"></script>

<html>
    <head>
        <meta charset="utf-8"/>
        <link rel="stylesheet" href="styles/style_chat.css"/>
        <title id="title_chat">Chat</title>
    </head>
    <body>
        <div id = "page">
            <div class = "left">
                <div id="left_title">
                    <h2>DYSSEKAURDE</h2>
                </div>

                <div id = "left_salons">
                    <button type = "button" id="Salons" onclick= "setRoom()">Room-1</button>
                </div>

                <div id = "left_user">
                    <h3 id="current_user_pseudo">Utilisateurs</h3>
                    <img src="" id="current_user_avatar">
                </div>
            </div>

            <div class = "mid">
                <div id="mid_title">
                    <h2>Chat</h2>
                </div>

                <div id = "mid_chat">
                    <div id="box_chat">
                    </div>
                </div>

                <div id = "mid_box_bottom">
                    <div id = "mid_send_container">
                        <input type="text" placeholder="Envoyer un message" id = "mid_input">
                        <button type = 'submit' id = "mid_send" onclick="buttonPressed()">
                            <img src="../Images/send_white.png" alt="Send" title="Send" class="image" width=100% height=100%/>
                    </div>
                    
                    <div id = mid_room_container>
                        <input type=""text placeholder="Choisir un salon" id="mid_input_room">
                        <button type="button" id="mid_send_room" onclick="joinRoom()">
                            <img src="../Images/send_white.png" alt="Send" title="Send" class="image" width=100% height=100%/>
                    </div>
                </div>
            </div>

            <div class = "right">
                <h2>Connexion</h2>
            </div>

        </div>
        <script language="javascript">
            var socket = io.connect('http://localhost:8080');

            socket.on('connect', function(){
                console.log('connect');
                displayMessage('You connected with id : ' + socket.id);
                socket.emit('get_infos');
                console.log(socket.pseudonyme);
            });

            socket.on('receive-message', function(message){
                displayMessage(message);
            });

            socket.on('receive_infos', function(user){
                console.log(user)
                document.getElementById('current_user_pseudo').innerHTML = user.pseudonyme;
                avatar = getAvatar(user.avatar);

                document.getElementById('current_user_avatar').src = avatar;
            })

            const messageInput = document.getElementById('mid_input');
            const roomInput = document.getElementById('mid_input_room');
            
            function getAvatar(avatar_id){
                switch(avatar_id){
                    case 'avatar_1': return "./Images/avatar_1.png"; break;
                    case 'avatar_2': return "./Images/avatar_2.png"; break;
                    case 'avatar_3': return "./Images/avatar_3.png"; break;
                    case 'avatar_4': return "./Images/avatar_4.png"; break;
                    default: return "./Images/avatar_5.png"; break;
                }
            }

            function setRoom()
            {
                roomInput.value = 'Room-1';
                joinRoom();
            }

            function buttonPressed()
            {
                const message = messageInput.value;
                const room = roomInput.value;
                socket.emit('send-message', message, room);
                displayMessage(message);
                messageInput.value = '';
            }

            function privateMessage()
            {
                const room = roomInput.value;
                displayMessage('You are now talking to : ' + room);
                
                socket.emit('join-room', room);
            }

            function joinRoom()
            {
                const room = roomInput.value;
                displayMessage('You joined room : ' + room);
                socket.emit('join-room', room);
            }

           function displayMessage(message)
           {
                const div = document.createElement('div');
                div.textContent = message;
                document.getElementById('box_chat').appendChild(div);
           } 

            function sendMessage(message)
            {
                alert(message);
            }

        </script>
    </body>
</html>